<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>A-Lab ì¼ì¼ë¡œê·¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #eef1f6;
      --card-bg: #f9fafc;
      --accent: #4caf50;
      --accent-soft: #e1f5e4;
      --danger: #ff5b6b;
      --text-main: #222;
      --text-sub: #707791;
      --border-soft: #dde2ee;
      --shadow-soft: 8px 8px 16px #d3d8e0, -8px -8px 16px #ffffff;
      --radius-card: 18px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Pretendard", "Segoe UI",
        system-ui, sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    .app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .main {
      width: 100%;
      max-width: 960px;
      padding: 8px 10px 140px; /* í•˜ë‹¨ ê³ ì • ì…ë ¥ì°½+ë„¤ë¹„ê²Œì´ì…˜ ê³µê°„ í™•ë³´ */
    }

    /* 110 í—¤ë”ë°” */
    .top-bar-wrap {
      width: 100%;
      display: flex;
      justify-content: center;
      position: sticky;
      top: 0;
      z-index: 20;
      background: linear-gradient(to bottom, var(--bg) 60%, transparent);
    }

    .top-bar {
      width: 100%;
      max-width: 960px;
      padding: 8px 12px 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .icon-button {
      border: none;
      background: transparent;
      font-size: 20px;
      padding: 6px;
      border-radius: 999px;
      cursor: pointer;
      color: var(--text-main);
    }

    .icon-button:hover {
      background: rgba(0, 0, 0, 0.03);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .logo-emoji {
      font-size: 22px;
    }

    /* ë¡œê³  í…ìŠ¤íŠ¸ 15% ì •ë„ í™•ëŒ€ */
    .logo-text {
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .top-bar-right {
      width: 24px;
      height: 24px;
    }

    /* ê³µí†µ ì„¹ì…˜ */
    .section {
      margin-top: 10px;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
      padding: 0 4px;
      font-size: 14px;
      color: var(--text-sub);
    }

    .section-title {
      font-weight: 600;
      color: #333;
    }

    .section-pill {
      font-size: 12px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.03);
    }

    .section-count {
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.03);
    }

    .section-right {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .helper-text {
      margin: 0 4px 4px;
      font-size: 12px;
      color: var(--text-sub);
    }

    /* ë²„íŠ¼ */
    .btn {
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      padding: 6px 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      white-space: nowrap;
    }

    .btn.primary {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 5px 12px rgba(76, 175, 80, 0.35);
    }

    .btn.primary:hover {
      filter: brightness(0.95);
    }

    .btn.ghost {
      background: #ffffff;
      color: var(--text-main);
      border: 1px solid rgba(0, 0, 0, 0.06);
    }

    .btn.ghost:hover {
      background: rgba(0, 0, 0, 0.03);
    }

    .btn.link {
      background: transparent;
      color: var(--text-sub);
      padding: 4px 8px;
      box-shadow: none;
    }

    .btn.link:hover {
      background: rgba(0, 0, 0, 0.03);
    }

    /* 120 ~ ì§„í–‰ë°” / ìš”ì•½ ì¹´ë“œ */

    .summary-section {
      padding: 10px 4px 4px;
    }

    .progress-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 11px;
      color: var(--text-sub);
      margin: 2px 4px 4px;
    }

    .progress-bar {
      width: 100%;
      height: 16px; /* 2ë°°ë¡œ ì¦ê°€ */
      border-radius: 999px;
      background: #dde3f1;
      overflow: hidden;
      box-shadow: inset 2px 2px 4px #c8cfdd, inset -2px -2px 4px #ffffff;
    }

    .progress-bar-fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #8bd68f, #4caf50);
      transition: width 0.25s ease-out;
    }

    .summary-cards {
      margin-top: 10px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    @media (max-width: 640px) {
      .summary-cards {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .summary-card {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      padding: 12px 14px;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .summary-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 6px;
      font-size: 13px;
    }

    .summary-card-title {
      font-weight: 700;
      margin-bottom: 2px;
    }

    .summary-card-sub {
      font-size: 12px;
      color: var(--text-sub);
    }

    .summary-card-time-group {
      text-align: right;
      font-size: 12px;
    }

    .summary-time {
      display: block;
      font-weight: 600;
    }

    .summary-diff {
      display: block;
      color: var(--danger);
      font-size: 11px;
      margin-top: 2px;
    }

    .summary-card-footer {
      display: flex;
      justify-content: flex-end;
    }

    .summary-card-buttons {
      display: flex;
      gap: 6px;
    }

    /* 200 ì•½ & ìˆ˜ë©´ ì¹´ë“œ */

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      box-shadow: var(--shadow-soft);
      padding: 10px 12px 12px;
    }

    .card-title {
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .med-sleep-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 6px;
    }

    @media (max-width: 720px) {
      .med-sleep-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .caret {
      font-size: 16px;
      padding: 2px 4px;
    }

    .checklist {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .check-item {
      padding: 6px 8px;
      border-radius: 14px;
      display: flex;
      align-items: flex-start;
      gap: 8px;
      background: #f4f6fb;
      box-shadow: inset 2px 2px 4px #d7dce7, inset -2px -2px 4px #ffffff;
      transition: background 0.15s ease-out, transform 0.1s ease-out;
    }

    .check-item.checked {
      background: #e8f6ea;
      transform: translateY(1px);
    }

    .check-input {
      margin-top: 3px;
    }

    .check-text {
      flex: 1;
      font-size: 13px;
    }

    .check-title {
      font-weight: 500;
      margin-bottom: 1px;
    }

    .check-times {
      font-size: 11px;
      color: var(--text-sub);
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
    }

    .planned-time.checked {
      text-decoration: line-through;
      color: #9da4ba;
    }

    .actual-time,
    .time-diff {
      color: var(--danger);
    }

    /* 300 ë‚´ ìƒíƒœ ê¸°ë¡ - í•˜ë‹¨ ê³ ì • ë°” */

    #stateSection {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 56px; /* ë„¤ë¹„ê²Œì´ì…˜ ë°”ë¡œ ìœ„ */
      padding: 6px 8px 10px;
      background: linear-gradient(to top, var(--bg) 85%, transparent);
      z-index: 25;
      margin-top: 0;
      display: flex;
      justify-content: center;
    }

    #stateSection .state-inner {
      width: 100%;
      max-width: 960px;
    }

    .state-input-row {
      display: flex;
      gap: 6px;
      margin: 4px 4px 0;
    }

    .state-input-row input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 8px 12px;
      font-size: 13px;
      outline: none;
      background: var(--card-bg);
      box-shadow: inset 2px 2px 3px #dde2ee, inset -2px -2px 4px #ffffff;
    }

    .state-input-row input:focus {
      border-color: #8fa2ff;
      box-shadow: 0 0 0 2px rgba(143, 162, 255, 0.35);
    }

    .records {
      margin-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .record-item {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 6px 10px 8px;
      box-shadow: var(--shadow-soft);
      font-size: 13px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    /* 350: ìƒë‹¨ì— ê²©ì°¨ì‹œê°„(ë°©ê¸ˆ ì „ / ëª‡ì‹œê°„ ì „) */
    .record-meta {
      font-size: 11px;
      color: var(--text-sub);
    }

    .record-main {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .record-text {
      flex: 1;
      word-break: break-word;
    }

    .record-time {
      font-size: 12px;
      color: var(--text-sub);
      margin-left: auto; /* í•­ìƒ ë§¨ ì˜¤ë¥¸ìª½ */
    }

    /* 800 ì•½&ìˆ˜ë©´ ìƒì„¸ë³´ê¸° í™”ë©´ */
    .detail-view {
      margin-top: 10px;
      padding: 10px 4px 40px;
    }

    .detail-card {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      box-shadow: var(--shadow-soft);
      padding: 14px 14px 18px;
    }

    .ms-tab-row {
      display: flex;
      margin: 6px 4px 10px;
      border-radius: 999px;
      background: #e0e4f0;
      padding: 3px;
      box-shadow: inset 2px 2px 4px #cbd1df, inset -2px -2px 4px #ffffff;
    }

    .ms-tab {
      flex: 1;
      border-radius: 999px;
      border: none;
      background: transparent;
      padding: 6px 0;
      font-size: 13px;
      cursor: pointer;
      color: var(--text-sub);
      transition: all 0.15s ease-out;
    }

    .ms-tab.active {
      background: #ffffff;
      color: #222;
      box-shadow: 2px 2px 4px #cbd1df, -2px -2px 4px #ffffff;
      font-weight: 600;
    }

    .ms-tab-panel {
      margin-top: 6px;
    }

    .ms-tab-placeholder {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      box-shadow: var(--shadow-soft);
      padding: 40px 10px;
      text-align: center;
      font-size: 14px;
      color: var(--text-sub);
      line-height: 1.6;
    }

    /* 900 í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #e3e7f0;
      box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.08);
      display: flex;
      justify-content: center;
      z-index: 30;
    }

    .bottom-nav-inner {
      width: 100%;
      max-width: 960px;
      display: flex;
    }

    .nav-item {
      flex: 1;
      padding: 6px 4px 8px;
      border: none;
      background: transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2px;
      font-size: 11px;
      color: var(--text-sub);
      cursor: pointer;
    }

    .nav-item .nav-icon {
      font-size: 16px;
    }

    .nav-item.active {
      color: #222;
      font-weight: 600;
    }

    .nav-item.active .nav-icon {
      transform: translateY(-1px);
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="top-bar-wrap">
      <header class="top-bar">
        <button class="icon-button" aria-label="ë©”ë‰´">â˜°</button>
        <div class="logo">
          <span class="logo-emoji">ğŸ§ </span>
          <span class="logo-text">A-Lab</span>
        </div>
        <div class="top-bar-right"></div>
      </header>
    </div>

    <main class="main">
      <!-- â–¼ 100~350: ì¼ì¼ë¡œê·¸ ë·° ì „ì²´ ë˜í¼ -->
      <div id="dailyView">
        <!-- 100~140 ì˜¤ëŠ˜ ìš”ì•½ -->
        <section class="section summary-section">
          <div class="section-header">
            <span class="section-title">â— ğŸ“ ê¸°ë¡í•˜ë©´ ì±„ì›Œì§€ëŠ” í•˜ë£¨</span>
            <span class="section-pill"><span id="completedCount">0</span>ê°œ ì™„ë£Œ</span>
          </div>

          <div class="progress-row">
            <span>ì˜¤ëŠ˜ ê¸°ë¡í• ìˆ˜ë¡ í¼ì„¼íŠ¸ê°€ ì±„ì›Œì§‘ë‹ˆë‹¤.</span>
            <span><span id="progressPercent">0</span>%</span>
          </div>

          <div class="progress-bar">
            <div class="progress-bar-fill" id="progressFill"></div>
          </div>

          <div class="summary-cards">
            <!-- 141 ì•½ ìš”ì•½ ì¹´ë“œ -->
            <article class="summary-card" data-summary="med">
              <div class="summary-card-header">
                <div>
                  <div class="summary-card-title">ğŸ’Š ì•½</div>
                  <div class="summary-card-sub" id="medSummaryLabel">ì•„ì¹¨</div>
                </div>
                <div class="summary-card-time-group">
                  <span class="summary-time" id="medSummaryTime">09:00</span>
                  <span class="summary-diff" id="medSummaryDiff">+0h00m</span>
                </div>
              </div>
              <div class="summary-card-footer">
                <div class="summary-card-buttons">
                  <button class="btn ghost" data-prev="med">ì´ì „</button>
                  <button class="btn primary" data-next="med">ë‹¤ìŒì— âœ</button>
                </div>
              </div>
            </article>

            <!-- 142 ìˆ˜ë©´ ìš”ì•½ ì¹´ë“œ -->
            <article class="summary-card" data-summary="sleep">
              <div class="summary-card-header">
                <div>
                  <div class="summary-card-title">ğŸ˜´ ìˆ˜ë©´</div>
                  <div class="summary-card-sub" id="sleepSummaryLabel">ëˆ„ìš´ ì‹œê°„</div>
                </div>
                <div class="summary-card-time-group">
                  <span class="summary-time" id="sleepSummaryTime">00:20</span>
                  <span class="summary-diff" id="sleepSummaryDiff">+0h00m</span>
                </div>
              </div>
              <div class="summary-card-footer">
                <div class="summary-card-buttons">
                  <button class="btn ghost" data-prev="sleep">ì´ì „</button>
                  <button class="btn primary" data-next="sleep">ë‹¤ìŒì— âœ</button>
                </div>
              </div>
            </article>
          </div>
        </section>

        <!-- 200 ì•½ & ìˆ˜ë©´ -->
        <section class="section" id="medSleepSection">
          <div class="section-header">
            <span class="section-title">â— ì•½ & ìˆ˜ë©´</span>
            <button class="icon-button caret" id="toggleMedSleep" aria-expanded="true">â–¾</button>
          </div>
          <div class="med-sleep-grid" id="medSleepBody">
            <div class="card column-card">
              <div class="card-title">ì•½ ë³µìš©</div>
              <ul class="checklist" id="medList"></ul>
            </div>
            <div class="card column-card">
              <div class="card-title">ìˆ˜ë©´ ê´€ë¦¬</div>
              <ul class="checklist" id="sleepList"></ul>
            </div>
          </div>
        </section>

        <!-- 300 ë‚´ ìƒíƒœ ê¸°ë¡ (í•˜ë‹¨ ê³ ì •) -->
        <section class="section" id="stateSection">
          <div class="state-inner">
            <div class="section-header">
              <span class="section-title">â— ë‚´ ìƒíƒœ ê¸°ë¡</span>
              <button class="btn link" id="viewAllBtn">ì „ì²´ë³´ê¸°</button>
            </div>
            <p class="helper-text">ì§€ê¸ˆ ë– ì˜¤ë¥´ëŠ” ìƒê°Â·ê¸°ë¶„ì„ í•œ ì¤„ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”.</p>
            <div class="state-input-row">
              <input
                type="text"
                id="stateInput"
                placeholder="ì—ì´ë©ë‹˜ ë°˜ê°€ì›Œìš”! ìƒíƒœë¥¼ ì•Œë ¤ì£¼ì„¸ìš”~"
              />
              <button class="btn primary" id="saveStateBtn" aria-label="ê¸°ë¡">
                ğŸ“¤
              </button>
            </div>
          </div>
        </section>

        <!-- 350 ê¸°ë¡ ë³´ê¸° -->
        <section class="section">
          <div class="section-header">
            <span class="section-title">â— ê¸°ë¡ ë³´ê¸°</span>
            <div class="section-right">
              <span class="section-count" id="recordCount">0</span>
              <button class="icon-button caret" id="toggleRecords" aria-expanded="true">â–¾</button>
            </div>
          </div>
          <div class="records" id="recordsContainer"></div>
        </section>
      </div>
      <!-- â–² dailyView ë -->

      <!-- 800 ì•½&ìˆ˜ë©´ ìƒì„¸ë³´ê¸° í™”ë©´ -->
      <section id="settingsView" class="detail-view" style="display:none;">
        <div class="section-header">
          <span class="section-title">â— ì•½&ìˆ˜ë©´ ìƒì„¸ë³´ê¸°</span>
        </div>

        <div class="detail-card">
          <div class="ms-tab-row">
            <button class="ms-tab active" data-tab="medTab">ì•½</button>
            <button class="ms-tab" data-tab="sleepTab">ìˆ˜ë©´</button>
          </div>

          <div id="medTab" class="ms-tab-panel">
            <div class="ms-tab-placeholder">
              ì•½ ìˆ˜ë©´ ê´€ë¦¬<br />
              ì²« í™”ë©´ ì•½ íƒ­ìœ¼ë¡œ ê³ ì •
            </div>
          </div>

          <div id="sleepTab" class="ms-tab-panel" style="display:none;">
            <div class="ms-tab-placeholder">
              ìˆ˜ë©´ íƒ­ë§Œ ëˆŒë €ì„ ê²½ìš°<br />
              (ì œëª©ë§Œ ë°˜ì˜)
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- 900 í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="bottom-nav">
      <div class="bottom-nav-inner">
        <button class="nav-item active">
          <span class="nav-icon">ğŸ’¬</span>
          <span class="nav-label">ë‚´ ìƒíƒœ</span>
        </button>
        <button class="nav-item">
          <span class="nav-icon">ğŸ§©</span>
          <span class="nav-label">í• ì¼ ë£¨í‹´</span>
        </button>
        <button class="nav-item">
          <span class="nav-icon">ğŸ“·</span>
          <span class="nav-label">ì¹´ë©”ë¼?</span>
        </button>
        <button class="nav-item">
          <span class="nav-icon">âœ…</span>
          <span class="nav-label">ì•½&ìˆ˜ë©´</span>
        </button>
        <button class="nav-item">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-label">í†µê³„ë³´ê¸°</span>
        </button>
      </div>
    </nav>
  </div>

  <script>
    // ---------- ë°ì´í„° ì„¤ì • ----------
    const medItems = [
      { id: "morning", label: "ì•„ì¹¨", time: "09:00" },
      { id: "noon", label: "ì ì‹¬", time: "13:00" },
      { id: "evening", label: "ì €ë…", time: "18:00" },
      { id: "bed", label: "ì·¨ì¹¨ì „", time: "23:30" },
      { id: "prn", label: "í•„ìš”ì‹œ", time: "00:00" },
      { id: "custom", label: "ì§ì ‘ì…ë ¥", time: "00:00" }
    ];

    const sleepItems = [
      { id: "wake", label: "ê¸°ìƒ", time: "07:30" },
      { id: "inBed", label: "ëˆ„ìš´ ì‹œê°„", time: "00:20" },
      { id: "sleep", label: "ì§„ì§œ ì”ë‹¤", time: "00:40" },
      { id: "up", label: "ì¼ì–´ë‚¨", time: "07:10" }
    ];

    const summaryIndex = {
      med: 0,
      sleep: 0
    };

    const records = [];

    // ---------- ìœ í‹¸ í•¨ìˆ˜ ----------
    function timeToMinutes(t) {
      const [h, m] = t.split(":").map(Number);
      return h * 60 + m;
    }

    function diffNowFromScheduled(timeStr) {
      const now = new Date();
      const nowMinutes = now.getHours() * 60 + now.getMinutes();
      return nowMinutes - timeToMinutes(timeStr);
    }

    function formatDiffMinutes(minDiff) {
      const sign = minDiff >= 0 ? "+" : "-";
      const abs = Math.abs(minDiff);
      const h = Math.floor(abs / 60);
      const m = abs % 60;
      return (
        sign + h.toString() + "h" + (m < 10 ? "0" + m.toString() : m.toString()) + "m"
      );
    }

    function getHHMM(date) {
      const h = date.getHours().toString().padStart(2, "0");
      const m = date.getMinutes().toString().padStart(2, "0");
      return `${h}:${m}`;
    }

    function formatKoreanDiff(ms) {
      const sec = Math.floor(ms / 1000);
      if (sec < 60) return "ë°©ê¸ˆ ì „";
      const min = Math.floor(sec / 60);
      const hour = Math.floor(min / 60);
      const remMin = min % 60;
      const parts = [];
      if (hour > 0) parts.push(hour + "ì‹œê°„");
      if (remMin > 0) parts.push(remMin + "ë¶„");
      return parts.join(" ") + " ì „";
    }

    // ---------- ì•½/ìˆ˜ë©´ ë¦¬ìŠ¤íŠ¸ ë Œë” ----------
    function createCheckItem(item, type) {
      const li = document.createElement("li");
      li.className = "check-item";
      li.dataset.type = type;
      li.dataset.id = item.id;
      li.dataset.scheduled = item.time;

      const input = document.createElement("input");
      input.type = "checkbox";
      input.className = "check-input";

      const textWrap = document.createElement("div");
      textWrap.className = "check-text";

      const title = document.createElement("div");
      title.className = "check-title";
      title.textContent = item.label;

      const times = document.createElement("div");
      times.className = "check-times";

      const planned = document.createElement("span");
      planned.className = "planned-time";
      planned.textContent = item.time;

      const actual = document.createElement("span");
      actual.className = "actual-time";

      const diff = document.createElement("span");
      diff.className = "time-diff";

      times.appendChild(planned);
      times.appendChild(actual);
      times.appendChild(diff);

      textWrap.appendChild(title);
      textWrap.appendChild(times);

      li.appendChild(input);
      li.appendChild(textWrap);

      input.addEventListener("change", () => handleCheckChange(li, input));

      return li;
    }

    function handleCheckChange(li, checkbox) {
      const plannedTime = li.dataset.scheduled;
      const plannedSpan = li.querySelector(".planned-time");
      const actualSpan = li.querySelector(".actual-time");
      const diffSpan = li.querySelector(".time-diff");

      if (checkbox.checked) {
        const now = new Date();
        const nowStr = getHHMM(now);
        li.dataset.actual = now.toISOString();
        actualSpan.textContent = nowStr;
        const diffMin = timeToMinutes(nowStr) - timeToMinutes(plannedTime);
        diffSpan.textContent = "(" + formatDiffMinutes(diffMin) + ")";
        plannedSpan.classList.add("checked");
        li.classList.add("checked");
      } else {
        li.dataset.actual = "";
        actualSpan.textContent = "";
        diffSpan.textContent = "";
        plannedSpan.classList.remove("checked");
        li.classList.remove("checked");
      }
      updateProgress();
    }

    function renderMedSleepLists() {
      const medList = document.getElementById("medList");
      const sleepList = document.getElementById("sleepList");
      medList.innerHTML = "";
      sleepList.innerHTML = "";

      medItems.forEach((item) => {
        medList.appendChild(createCheckItem(item, "med"));
      });
      sleepItems.forEach((item) => {
        sleepList.appendChild(createCheckItem(item, "sleep"));
      });
    }

    // ---------- ì§„í–‰ë¥  / ì™„ë£Œ ê°œìˆ˜ ----------
    function updateProgress() {
      const checkboxes = document.querySelectorAll(".check-input");
      const total = checkboxes.length;
      let checked = 0;
      checkboxes.forEach((cb) => {
        if (cb.checked) checked++;
      });
      const percent = total === 0 ? 0 : Math.round((checked / total) * 100);
      document.getElementById("progressPercent").textContent = percent;
      document.getElementById("progressFill").style.width = percent + "%";
      document.getElementById("completedCount").textContent = checked;
    }

    // ---------- ìƒë‹¨ ìš”ì•½ ì¹´ë“œ ----------
    function updateSummaryCard(type) {
      const items = type === "med" ? medItems : sleepItems;
      if (items.length === 0) return;
      const index = ((summaryIndex[type] % items.length) + items.length) % items.length;
      summaryIndex[type] = index;
      const item = items[index];

      const labelId = type === "med" ? "medSummaryLabel" : "sleepSummaryLabel";
      const timeId = type === "med" ? "medSummaryTime" : "sleepSummaryTime";
      const diffId = type === "med" ? "medSummaryDiff" : "sleepSummaryDiff";

      document.getElementById(labelId).textContent = item.label;
      document.getElementById(timeId).textContent = item.time;
      const diffMin = diffNowFromScheduled(item.time);
      document.getElementById(diffId).textContent = formatDiffMinutes(diffMin);
    }

    function initSummaryButtons() {
      document.querySelectorAll("button[data-next]").forEach((btn) => {
        const type = btn.dataset.next;
        btn.addEventListener("click", () => {
          summaryIndex[type] += 1;
          updateSummaryCard(type);
        });
      });

      document.querySelectorAll("button[data-prev]").forEach((btn) => {
        const type = btn.dataset.prev;
        btn.addEventListener("click", () => {
          summaryIndex[type] -= 1;
          updateSummaryCard(type);
        });
      });
    }

    // ---------- ë‚´ ìƒíƒœ ê¸°ë¡ / ê¸°ë¡ ë³´ê¸° (350) ----------
    function renderRecords() {
      const container = document.getElementById("recordsContainer");
      container.innerHTML = "";
      const LIMIT = 80; // ê¸°ë¡ í…ìŠ¤íŠ¸ ìµœëŒ€ 80ì ë…¸ì¶œ

      const len = records.length;

      // ìµœì‹  ê¸°ë¡ì´ ìœ„ì—ì„œë¶€í„° ë³´ì´ë„ë¡ ì—­ìˆœ ë Œë”ë§
      for (let i = len - 1; i >= 0; i--) {
        const rec = records[i];
        const uiIndex = (len - 1) - i; // 0 = ê°€ì¥ ìµœê·¼, 1 = ê·¸ ì´ì „...

        const item = document.createElement("div");
        item.className = "record-item";

        // ìƒë‹¨: ì‹œê°„ ì°¨ (ì§ì „ ê¸°ë¡ ê¸°ì¤€)
        const meta = document.createElement("div");
        meta.className = "record-meta";

        if (uiIndex === 0) {
          meta.textContent = "ë°©ê¸ˆ ì „";
        } else {
          const newer = records[i + 1]; // ë” ìµœê·¼
          const diffMs = newer.time.getTime() - rec.time.getTime();
          meta.textContent = formatKoreanDiff(diffMs);
        }

        // ë³¸ë¬¸: í…ìŠ¤íŠ¸ + ê¸°ë¡ ì‹œê°„
        const main = document.createElement("div");
        main.className = "record-main";

        const textSpan = document.createElement("div");
        textSpan.className = "record-text";

        let display = rec.text;
        if (display.length > LIMIT) {
          textSpan.textContent = display.slice(0, LIMIT) + "â€¦";
          textSpan.title = rec.text;
        } else {
          textSpan.textContent = display;
        }

        const timeSpan = document.createElement("div");
        timeSpan.className = "record-time";
        timeSpan.textContent = getHHMM(rec.time);

        main.appendChild(textSpan);
        main.appendChild(timeSpan);

        item.appendChild(meta);
        item.appendChild(main);

        container.appendChild(item);
      }

      document.getElementById("recordCount").textContent = records.length;
    }

    // ---------- ì•½&ìˆ˜ë©´ ì„¹ì…˜ í† ê¸€ ----------
    function initMedSleepToggle() {
      const btn = document.getElementById("toggleMedSleep");
      const body = document.getElementById("medSleepBody");
      btn.addEventListener("click", () => {
        const isHidden = body.style.display === "none";
        body.style.display = isHidden ? "grid" : "none";
        btn.textContent = isHidden ? "â–¾" : "â–´";
        btn.setAttribute("aria-expanded", isHidden ? "true" : "false");
      });
    }

    // ---------- ê¸°ë¡ ë³´ê¸° ì•„ì½”ë””ì–¸ ----------
    function initRecordsToggle() {
      const btn = document.getElementById("toggleRecords");
      const container = document.getElementById("recordsContainer");
      if (!btn || !container) return;
      btn.addEventListener("click", () => {
        const isHidden = container.style.display === "none";
        container.style.display = isHidden ? "flex" : "none";
        btn.textContent = isHidden ? "â–¾" : "â–´";
        btn.setAttribute("aria-expanded", isHidden ? "true" : "false");
      });
    }

    // ---------- ë‚´ ìƒíƒœ ì…ë ¥ ----------
    function initStateInput() {
      const input = document.getElementById("stateInput");
      const btn = document.getElementById("saveStateBtn");
      if (!input || !btn) return;

      function save() {
        const text = input.value.trim();
        if (!text) return;
        const now = new Date();
        records.push({ text, time: now });
        input.value = "";
        renderRecords();
      }

      btn.addEventListener("click", save);
      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          save();
        }
      });
    }

    // ---------- 800 ë„¤ë¹„ê²Œì´ì…˜: ì¼ì¼ë¡œê·¸ <-> ì•½&ìˆ˜ë©´ ìƒì„¸ë³´ê¸° ----------
    function showDailyView() {
      const daily = document.getElementById("dailyView");
      const settings = document.getElementById("settingsView");
      if (daily) daily.style.display = "block";
      if (settings) settings.style.display = "none";
    }

    function showSettingsView() {
      const daily = document.getElementById("dailyView");
      const settings = document.getElementById("settingsView");
      if (daily) daily.style.display = "none";
      if (settings) settings.style.display = "block";
    }

    function initNavRouting() {
      const navItems = document.querySelectorAll(".bottom-nav-inner .nav-item");
      if (navItems.length < 4) return;

      const homeBtn = navItems[0];        // 1ë²ˆì§¸: ë‚´ ìƒíƒœ
      const medSettingsBtn = navItems[3]; // 4ë²ˆì§¸: ì•½&ìˆ˜ë©´

      homeBtn.addEventListener("click", () => {
        navItems.forEach((b) => b.classList.remove("active"));
        homeBtn.classList.add("active");
        showDailyView();
      });

      medSettingsBtn.addEventListener("click", () => {
        navItems.forEach((b) => b.classList.remove("active"));
        medSettingsBtn.classList.add("active");
        showSettingsView();
      });
    }

    // ---------- 810 ì•½/ìˆ˜ë©´ íƒ­ í† ê¸€ ----------
    function initDetailTabs() {
      const tabs = document.querySelectorAll(".ms-tab-row .ms-tab");
      const panels = document.querySelectorAll(".ms-tab-panel");
      if (!tabs.length || !panels.length) return;

      tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          const targetId = tab.dataset.tab;

          tabs.forEach((t) => t.classList.remove("active"));
          tab.classList.add("active");

          panels.forEach((p) => {
            p.style.display = p.id === targetId ? "block" : "none";
          });
        });
      });
    }

    // ---------- ì´ˆê¸°í™” ----------
    function init() {
      renderMedSleepLists();
      updateProgress();
      updateSummaryCard("med");
      updateSummaryCard("sleep");
      initSummaryButtons();
      initStateInput();
      initMedSleepToggle();
      initRecordsToggle();
      initNavRouting();
      initDetailTabs();
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
