<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì—ì´ë© ì¼ì¼ ë¡œê·¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 16px; }
    h1 { font-size: 1.4rem; margin-bottom: 8px; }
    h2 { font-size: 1.1rem; margin-top: 24px; margin-bottom: 8px; }
    .section { border: 1px solid #ccc; border-radius: 8px; padding: 12px; margin-bottom: 12px; }
    label { display: block; margin-bottom: 4px; font-size: 0.9rem; }
    input, select, textarea { width: 100%; padding: 6px; margin-bottom: 8px; box-sizing: border-box; }
    textarea { min-height: 60px; }
    button { padding: 6px 10px; border-radius: 6px; border: 1px solid #ccc; cursor: pointer; background: #f9f9f9; }
    button#saveBtn { padding: 8px 14px; background: #333; color: #fff; border: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 12px; font-size: 0.85rem; }
    th, td { border: 1px solid #ddd; padding: 6px; text-align: center; }
    th { background: #f5f5f5; }
    .small { font-size: 0.8rem; color: #666; }

    .row-flex { display: flex; gap: 6px; align-items: center; margin-bottom: 6px; }
    .row-flex input[type="text"] { flex: 1; margin-bottom: 0; }
    .row-flex select { flex: 1; margin-bottom: 0; }
    .row-flex input[type="checkbox"] { width: auto; margin-bottom: 0; }
    .row-flex button { width: auto; margin-bottom: 0; }

    .done-line { text-decoration: line-through; opacity: 0.5; }

    .time-label { margin-left: 4px; color: red; font-size: 0.8rem; }

    .tag-box { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 4px; }
    .tag-box label { display: flex; align-items: center; gap: 2px; border: 1px solid #ddd; border-radius: 12px; padding: 2px 8px; font-size: 0.8rem; margin-bottom: 0; }
    .tag-box input[type="checkbox"] { width: auto; margin: 0; }

    .score-label { display: inline-block; margin-bottom: 4px; }
    .score-current { font-weight: bold; }
  </style>
</head>
<body>
  <h1>ì—ì´ë© ì¼ì¼ ë¡œê·¸</h1>
  <p class="small">ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤ (localStorage). ìƒˆë¡œê³ ì¹¨í•´ë„ ê¸°ë¡ì€ ë‚¨ìŠµë‹ˆë‹¤.</p>

  <form id="logForm">
    <!-- 1. ë‚ ì§œ & ì˜¤ëŠ˜ í•  ì¼ / ì•ˆ í•œ ì¼ -->
    <div class="section">
      <h2>1. ë‚ ì§œ & ì˜¤ëŠ˜ í•  ì¼</h2>
      <label for="date">ë‚ ì§œ</label>
      <input type="date" id="date" required />

      <label>ì˜¤ëŠ˜ í•µì‹¬ í•  ì¼ (ìµœëŒ€ 3ê°œ)</label>

      <div class="row-flex">
        <input type="text" id="keyTask1" placeholder="ì˜ˆ: ì—ì´ë© ì¼ì¼ ë¡œê·¸ ì„¤ê³„" />
        <input type="checkbox" id="keyTask1Done" title="ì™„ë£Œ" />
      </div>
      <div class="row-flex">
        <input type="text" id="keyTask2" placeholder="ì˜ˆ: ì•½Â·ìˆ˜ë©´ ê¸°ë¡í•˜ê¸°" />
        <input type="checkbox" id="keyTask2Done" title="ì™„ë£Œ" />
      </div>
      <div class="row-flex">
        <input type="text" id="keyTask3" placeholder="ì˜ˆ: ë°© ì •ë¦¬ 10ë¶„" />
        <input type="checkbox" id="keyTask3Done" title="ì™„ë£Œ" />
      </div>

      <label>ì˜¤ëŠ˜ ì•ˆ í•œ ì¼ (í”¼í•˜ê³  ì‹¶ì€ ê²ƒ)</label>
      <div class="row-flex">
        <input type="text" id="keyNotTasks" placeholder="ì˜ˆ: ì•¼ì‹, ì“¸ë°ì—†ëŠ” ë‰´ìŠ¤ ë³´ê¸°" />
        <input type="checkbox" id="keyNotTasksDone" title="ì§€í‚¨ ê²½ìš° ì²´í¬" />
      </div>
    </div>

    <!-- 2. ì•½ ë³µìš© 3ê°œ -->
    <div class="section">
      <h2>2. ì•½ ë³µìš© ğŸ’Š (ìµœëŒ€ 3ê°œ)</h2>

      <h3 style="font-size:0.95rem; margin:8px 0;">ì•„ì¹¨</h3>
      <label>ë³µìš©í•˜ì‹œëŠ” ì•½ 1
        <span id="med1TimeLabel" class="time-label"></span>
      </label>
      <div class="row-flex">
        <input type="text" id="med1Name" placeholder="ì˜ˆ: ì½˜ì„œíƒ€ 36mg" />
        <input type="checkbox" id="med1Taken" title="ë³µìš© ì‹œ ì²´í¬" />
      </div>

      <h3 style="font-size:0.95rem; margin:8px 0;">ì ì‹¬</h3>
      <label>ë³µìš©í•˜ì‹œëŠ” ì•½ 2
        <span id="med2TimeLabel" class="time-label"></span>
      </label>
      <div class="row-flex">
        <input type="text" id="med2Name" placeholder="ì˜ˆ: ë¼ë¯¹íƒˆ 100mg" />
        <input type="checkbox" id="med2Taken" title="ë³µìš© ì‹œ ì²´í¬" />
      </div>

      <h3 style="font-size:0.95rem; margin:8px 0;">ì €ë…</h3>
      <label>ë³µìš©í•˜ì‹œëŠ” ì•½ 3
        <span id="med3TimeLabel" class="time-label"></span>
      </label>
      <div class="row-flex">
        <input type="text" id="med3Name" placeholder="ì˜ˆ: ë¦¬ë³´íŠ¸ë¦´ 0.25mg" />
        <input type="checkbox" id="med3Taken" title="ë³µìš© ì‹œ ì²´í¬" />
      </div>
    </div>

    <!-- 3. ìˆ˜ë©´ (8ë‹¨ê³„ ì´ë²¤íŠ¸, ì²´í¬ ì‹œ í•­ëª© ì˜†ì— ë‚ ì§œ+ì‹œê°„ í‘œì‹œ) -->
    <div class="section">
      <h2>3. ìˆ˜ë©´ ğŸŒ™</h2>

      <div>
        <label>ëˆ„ìš´ ì‹œê°„
          <span id="bedStamp" class="time-label"></span>
        </label>
        <div class="row-flex">
          <input type="text" id="bedNote" placeholder="ì˜ˆ: ì¹¨ëŒ€ì— ëˆ„ìš´ ì‹œê° ëŠë‚Œ ë©”ëª¨" />
          <input type="checkbox" id="bedChk" title="ëˆ„ì› ì„ ë•Œ ì²´í¬" />
        </div>
      </div>

      <div>
        <label>í° í• êº¼ì•¼
          <span id="phoneStamp" class="time-label"></span>
        </label>
        <div class="row-flex">
          <input type="text" id="phoneNote" placeholder="ì˜ˆ: ìœ íŠœë¸Œ / SNS / ì›¹ì„œí•‘ ë“±" />
          <input type="checkbox" id="phoneChk" title="í° ë³´ê¸° ì‹œì‘ ì‹œ ì²´í¬" />
        </div>
      </div>

      <div>
        <label>ì  ì•ˆì˜´
          <span id="noSleepStamp" class="time-label"></span>
        </label>
        <div class="row-flex">
          <input type="text" id="noSleepNote" placeholder="ì˜ˆ: ìƒê° ë§ìŒ, ë¶ˆì•ˆ, ëª¸ ë¶ˆí¸ ë“±" />
          <input type="checkbox" id="noSleepChk" title="ì  ì•ˆ ì˜¨ë‹¤ê³  ëŠë‚„ ë•Œ ì²´í¬" />
        </div>
      </div>

      <div>
        <label>ì§„ì§œ ì”ë‹¤ (ì ë“  ì‹œê° ëŠë‚Œ)
          <span id="sleepRealStamp" class="time-label"></span>
        </label>
        <div class="row-flex">
          <input type="text" id="sleepRealNote" placeholder="ì˜ˆ: ëˆˆ ê°ê³  ë” ì´ìƒ í° ì•ˆ ì¡ìŒ" />
          <input type="checkbox" id="sleepRealChk" title="ì  ë“¤ì—ˆë‹¤ê³  ëŠë‚„ ë•Œ ì²´í¬" />
        </div>
      </div>

      <div>
        <label>ì¼ì–´ë‚¨
          <span id="wakeStamp" class="time-label"></span>
        </label>
        <div class="row-flex">
          <input type="text" id="wakeNote" placeholder="ì˜ˆ: ì•ŒëŒ ìš¸ë¦¼, í•œ ë²ˆ ê¹¸" />
          <input type="checkbox" id="wakeChk" title="ê¹¨ëŠ” ìˆœê°„ ì²´í¬" />
        </div>
      </div>

      <div>
        <label>ê¾¸ë¬¼ê±°ë¦¼
          <span id="lingerStamp" class="time-label"></span>
        </label>
        <div class="row-flex">
          <input type="text" id="lingerNote" placeholder="ì˜ˆ: ì¹¨ëŒ€ì—ì„œ í°, ë©ë•Œë¦¬ê¸° ë“±" />
          <input type="checkbox" id="lingerChk" title="ê¾¸ë¬¼ê±°ë¦¬ê¸° ì‹œì‘ ì‹œ ì²´í¬" />
        </div>
      </div>

      <div>
        <label>ì§„ì§œ ì¼ì–´ë‚¨
          <span id="wakeRealStamp" class="time-label"></span>
        </label>
        <div class="row-flex">
          <input type="text" id="wakeRealNote" placeholder="ì˜ˆ: ìë¦¬ì—ì„œ ì™„ì „íˆ ì¼ì–´ë‚¨" />
          <input type="checkbox" id="wakeRealChk" title="ì™„ì „íˆ ì¼ì–´ë‚œ ì‹œì  ì²´í¬" />
        </div>
      </div>

      <div>
        <label>ë°¤ìƒ˜
          <span id="allNightStamp" class="time-label"></span>
        </label>
        <div class="row-flex">
          <input type="text" id="allNightNote" placeholder="ì˜ˆ: ë°¤ìƒˆ ì‘ì—…, ë°¤ìƒ˜ ëŠë‚Œ ë©”ëª¨" />
          <input type="checkbox" id="allNightChk" title="ë°¤ìƒ˜ ì‹œ ì²´í¬" />
        </div>
      </div>
    </div>

    <!-- 4. ê¸°ë¶„ / ì—ë„ˆì§€ / ì§‘ì¤‘ -->
    <div class="section">
      <h2>4. ê¸°ë¶„ / ì—ë„ˆì§€ / ì§‘ì¤‘ ğŸ™‚</h2>

      <!-- ê¸°ë¶„: ì ìˆ˜ + ë²„íŠ¼ -->
      <span class="score-label">ê¸°ë¶„ ì ìˆ˜ (0~100)</span>
      <div class="row-flex">
        <span class="small">í˜„ì¬: <span id="moodValue" class="score-current">0</span></span>
        <input type="hidden" id="mood" value="0" />
      </div>
      <div class="row-flex">
        <button type="button" id="moodMinus5">-</button><span>5</span><button type="button" id="moodPlus5">+</button>
        <button type="button" id="moodMinus10">-</button><span>10</span><button type="button" id="moodPlus10">+</button>
      </div>

      <label for="energy">ì—ë„ˆì§€ / ê°ì„± ì •ë„</label>
      <select id="energy">
        <option value="">ì„ íƒ</option>
        <option value="1">1 - ê±°ì˜ ì—†ìŒ</option>
        <option value="2">2 - ë‚®ìŒ</option>
        <option value="3">3 - ë³´í†µ</option>
        <option value="4">4 - ë†’ìŒ</option>
        <option value="5">5 - ê³¼ê°ì„± ëŠë‚Œ</option>
      </select>

      <label for="focus">ì§‘ì¤‘ë„</label>
      <select id="focus">
        <option value="">ì„ íƒ</option>
        <option value="1">1 - ì „í˜€ ì•ˆ ë¨</option>
        <option value="2">2 - ì˜ ì•ˆ ë¨</option>
        <option value="3">3 - ì¤‘ê°„</option>
        <option value="4">4 - ì˜ ë¨</option>
        <option value="5">5 - ë§¤ìš° ì˜ ë¨</option>
      </select>

      <label for="moodReason">ì™œ ê·¸ëŸ° ê¸°ë¶„ì´ì—ˆëŠ”ì§€ (ê°„ë‹¨íˆ)</label>
      <input type="text" id="moodReason" placeholder="ì˜ˆ: ì  ë¶€ì¡±, ì‚¬ëŒê³¼ì˜ ê°ˆë“±, ì¼ ì˜ í’€ë¦¼ ë“±" />
    </div>

    <!-- 5. í•  ì¼ ì§„í–‰ & ë©”ëª¨ -->
    <div class="section">
      <h2>5. í•  ì¼ ì§„í–‰ & ë©”ëª¨</h2>

      <!-- ì™„ë£Œìœ¨: ì ìˆ˜ + ë²„íŠ¼ -->
      <span class="score-label">ì˜¤ëŠ˜ í–ˆì–´ì•¼ í•˜ëŠ” ì¼ ì™„ë£Œìœ¨ (%)</span>
      <div class="row-flex">
        <span class="small">í˜„ì¬: <span id="taskDoneValue" class="score-current">0</span>%</span>
        <input type="hidden" id="taskDone" value="0" />
      </div>
      <div class="row-flex">
        <button type="button" id="taskDoneMinus5">-</button><span>5</span><button type="button" id="taskDonePlus5">+</button>
        <button type="button" id="taskDoneMinus10">-</button><span>10</span><button type="button" id="taskDonePlus10">+</button>
      </div>

      <label for="notes">ë©”ëª¨ / íŠ¹ì´ì‚¬í•­</label>
      <textarea id="notes" placeholder="ë¶€ì‘ìš©, ê¸°ë¶„ ë³€í™”, ì‚¬ê±´ ë“±ì„ ììœ ë¡­ê²Œ ì ê¸°"></textarea>

      <!-- ëª»í•œ ëŠë‚Œ: ì ìˆ˜ + ë²„íŠ¼ -->
      <span class="score-label">ì˜¤ëŠ˜ ëª»í•œ ëŠë‚Œ (%)</span>
      <div class="row-flex">
        <span class="small">í˜„ì¬: <span id="notDoneValue" class="score-current">0</span>%</span>
        <input type="hidden" id="notDoneFeeling" value="0" />
      </div>
      <div class="row-flex">
        <button type="button" id="notDoneMinus5">-</button><span>5</span><button type="button" id="notDonePlus5">+</button>
        <button type="button" id="notDoneMinus10">-</button><span>10</span><button type="button" id="notDonePlus10">+</button>
      </div>

      <label for="notesNotDone">ë©”ëª¨ / íŠ¹ì´ì‚¬í•­ (ëª»í•œ ë¶€ë¶„ ìœ„ì£¼)</label>
      <textarea id="notesNotDone" placeholder="ëª»í•œ ì¼, ë‚¨ì€ ì°ì°í•¨ ë“±ì„ ììœ ë¡­ê²Œ ì ê¸°"></textarea>

      <!-- ë©”ëª¨ íƒœê·¸ -->
      <span class="small" style="display:block; margin-top:6px;">ë©”ëª¨ íƒœê·¸ (ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥, Aì•ˆ: íšŸìˆ˜ í†µê³„ìš©)</span>
      <div class="tag-box">
        <label><input type="checkbox" class="memoTag" value="ë‘í†µ/ëª¸ ë¶ˆí¸" />ë‘í†µ/ëª¸ ë¶ˆí¸</label>
        <label><input type="checkbox" class="memoTag" value="ê³¼ê°ì„±" />ê³¼ê°ì„±</label>
        <label><input type="checkbox" class="memoTag" value="ê³¼ì‹/ì•¼ì‹" />ê³¼ì‹/ì•¼ì‹</label>
        <label><input type="checkbox" class="memoTag" value="ê´€ê³„ ìŠ¤íŠ¸ë ˆìŠ¤" />ê´€ê³„ ìŠ¤íŠ¸ë ˆìŠ¤</label>
        <label><input type="checkbox" class="memoTag" value="ê°ì • ê¸°ë³µ í¼" />ê°ì • ê¸°ë³µ í¼</label>
        <label><input type="checkbox" class="memoTag" value="ì»¨ë””ì…˜ ì¢‹ìŒ" />ì»¨ë””ì…˜ ì¢‹ìŒ</label>
      </div>

      <!-- ì²´í¬ ìš”ì•½ -->
      <div id="checkSummaryBox" class="small" style="margin-top:8px;">
        <div>ì˜¤ëŠ˜ ì „ì²´ ì²´í¬ìˆ˜ : <span id="totalCheckCount" style="color:red;">0</span>ê°œ</div>
        <div>1. ë‚ ì§œ & ì˜¤ëŠ˜ í•  ì¼: <span id="checkCount1">0</span>ê°œ</div>
        <div>2. ì•½ ë³µìš©: <span id="checkCount2">0</span>ê°œ</div>
        <div>3. ìˆ˜ë©´: <span id="checkCount3">0</span>ê°œ</div>
        <div>4. ê¸°ë¶„/ì—ë„ˆì§€/ì§‘ì¤‘: <span id="checkCount4">0</span>ê°œ</div>
        <div>5. í•  ì¼ ì§„í–‰ & ë©”ëª¨: <span id="checkCount5">0</span>ê°œ</div>
      </div>
    </div>

    <button type="submit" id="saveBtn">ì €ì¥</button>
  </form>

  <h2>ìµœê·¼ 7ì¼ ë¡œê·¸</h2>
  <table id="logTable">
    <thead>
      <tr>
        <th>ë‚ ì§œ</th>
        <th>ìˆ˜ë©´(ì§„ì§œ ì”ë‹¤~ì§„ì§œ ì¼ì–´ë‚¨)</th>
        <th>ì•½ (ë³µìš©í•œ ì•½ ì´ë¦„)</th>
        <th>ê¸°ë¶„</th>
        <th>ì—ë„ˆì§€</th>
        <th>ì§‘ì¤‘</th>
        <th>ì™„ë£Œìœ¨</th>
        <th>íƒœê·¸</th>
        <th>ë©”ëª¨</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3 style="margin-top:16px;">ë©”ëª¨ íƒœê·¸ í†µê³„ (ì „ì²´ ëˆ„ì )</h3>
  <div id="tagStats" class="small"></div>

  <script>
    const STORAGE_KEY = "dailyLogs_v2";

    const MEMO_TAG_LIST = [
      "ë‘í†µ/ëª¸ ë¶ˆí¸",
      "ê³¼ê°ì„±",
      "ê³¼ì‹/ì•¼ì‹",
      "ê´€ê³„ ìŠ¤íŠ¸ë ˆìŠ¤",
      "ê°ì • ê¸°ë³µ í¼",
      "ì»¨ë””ì…˜ ì¢‹ìŒ"
    ];

    // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë³¸ê°’ ì„¤ì •
    (function setToday() {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, "0");
      const dd = String(today.getDate()).padStart(2, "0");
      document.getElementById("date").value = `${yyyy}-${mm}-${dd}`;
    })();

    function loadLogs() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return [];
      try {
        return JSON.parse(raw);
      } catch (e) {
        console.error("JSON parse error", e);
        return [];
      }
    }

    function saveLogs(logs) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(logs));
    }

    // ì²´í¬í•˜ë©´ ì¤„ ê¸‹ê¸° (ì˜¤ëŠ˜ í•  ì¼ / ì˜¤ëŠ˜ ì•ˆ í•œ ì¼)
    function attachStrikeCheckbox(checkboxId, inputId) {
      const cb = document.getElementById(checkboxId);
      const input = document.getElementById(inputId);
      if (!cb || !input) return;
      cb.addEventListener("change", () => {
        if (cb.checked) input.classList.add("done-line");
        else input.classList.remove("done-line");
      });
    }

    attachStrikeCheckbox("keyTask1Done", "keyTask1");
    attachStrikeCheckbox("keyTask2Done", "keyTask2");
    attachStrikeCheckbox("keyTask3Done", "keyTask3");
    attachStrikeCheckbox("keyNotTasksDone", "keyNotTasks");

    // ë‚ ì§œ+ì‹œê°„ í¬ë§·: 25-11-18 23:10
    function formatNowTime() {
      const d = new Date();
      const yy = String(d.getFullYear()).slice(2);  // ë’¤ 2ìë¦¬
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      const h = String(d.getHours()).padStart(2, "0");
      const m = String(d.getMinutes()).padStart(2, "0");
      return `${yy}-${mm}-${dd} ${h}:${m}`;
    }

    // ì²´í¬í•˜ë©´ í˜„ì¬ ë‚ ì§œ+ì‹œê°„ ë¹¨ê°„ìƒ‰ í‘œì‹œ (ì•½ / ìˆ˜ë©´)
    function attachTimeCheckbox(checkboxId, spanId) {
      const cb = document.getElementById(checkboxId);
      const span = document.getElementById(spanId);
      if (!cb || !span) return;
      cb.addEventListener("change", () => {
        if (cb.checked) {
          span.textContent = formatNowTime();
        } else {
          span.textContent = "";
        }
      });
    }

    // ì•½ 3ê°œ
    attachTimeCheckbox("med1Taken", "med1TimeLabel");
    attachTimeCheckbox("med2Taken", "med2TimeLabel");
    attachTimeCheckbox("med3Taken", "med3TimeLabel");

    // ìˆ˜ë©´ 8ê°œ
    attachTimeCheckbox("bedChk", "bedStamp");
    attachTimeCheckbox("phoneChk", "phoneStamp");
    attachTimeCheckbox("noSleepChk", "noSleepStamp");
    attachTimeCheckbox("sleepRealChk", "sleepRealStamp");
    attachTimeCheckbox("wakeChk", "wakeStamp");
    attachTimeCheckbox("lingerChk", "lingerStamp");
    attachTimeCheckbox("wakeRealChk", "wakeRealStamp");
    attachTimeCheckbox("allNightChk", "allNightStamp");

    // ì ìˆ˜í˜• ì»¨íŠ¸ë¡¤ ê³µí†µ í•¨ìˆ˜
    function makeScoreController(valueSpanId, hiddenInputId, minus5Id, plus5Id, minus10Id, plus10Id) {
      let value = 0;
      const span = document.getElementById(valueSpanId);
      const hidden = document.getElementById(hiddenInputId);

      function updateDisplay() {
        span.textContent = value;
        hidden.value = value;
      }
      updateDisplay();

      function clamp(v) {
        if (v < 0) return 0;
        if (v > 100) return 100;
        return v;
      }

      const m5 = document.getElementById(minus5Id);
      const p5 = document.getElementById(plus5Id);
      const m10 = document.getElementById(minus10Id);
      const p10 = document.getElementById(plus10Id);

      if (m5) m5.addEventListener("click", () => { value = clamp(value - 5); updateDisplay(); });
      if (p5) p5.addEventListener("click", () => { value = clamp(value + 5); updateDisplay(); });
      if (m10) m10.addEventListener("click", () => { value = clamp(value - 10); updateDisplay(); });
      if (p10) p10.addEventListener("click", () => { value = clamp(value + 10); updateDisplay(); });

      return {
        getValue: () => value,
        setValue: (v) => { value = clamp(Number(v) || 0); updateDisplay(); }
      };
    }

    // ê¸°ë¶„, ì™„ë£Œìœ¨, ëª»í•œ ëŠë‚Œ ì»¨íŠ¸ë¡¤ ìƒì„±
    const moodController = makeScoreController("moodValue", "mood", "moodMinus5", "moodPlus5", "moodMinus10", "moodPlus10");
    const taskDoneController = makeScoreController("taskDoneValue", "taskDone", "taskDoneMinus5", "taskDonePlus5", "taskDoneMinus10", "taskDonePlus10");
    const notDoneController = makeScoreController("notDoneValue", "notDoneFeeling", "notDoneMinus5", "notDonePlus5", "notDoneMinus10", "notDonePlus10");

    function renderTableAndStats() {
      const logs = loadLogs().sort((a, b) => b.date.localeCompare(a.date));
      const tbody = document.querySelector("#logTable tbody");
      tbody.innerHTML = "";

      // íƒœê·¸ í†µê³„ ì´ˆê¸°í™”
      const tagCounts = {};
      MEMO_TAG_LIST.forEach(t => tagCounts[t] = 0);

      logs.slice(0, 7).forEach(log => {
        // ìˆ˜ë©´ ìš”ì•½: ì§„ì§œ ì”ë‹¤ ~ ì§„ì§œ ì¼ì–´ë‚¨ ê¸°ì¤€
        const start = log.sleepRealStamp || log.bedStamp || "";
        const end = log.wakeRealStamp || log.wakeStamp || "";
        let sleepText = "-";
        if (start || end) {
          const sTxt = start || "?";
          const eTxt = end || "?";
          sleepText = `${sTxt} ~ ${eTxt}`;
        }

        // ì•½ ìš”ì•½
        const meds = [];
        if (log.med1Name && log.med1Taken) meds.push(log.med1Name);
        if (log.med2Name && log.med2Taken) meds.push(log.med2Name);
        if (log.med3Name && log.med3Taken) meds.push(log.med3Name);
        const medSummary = meds.join(", ");

        // ë©”ëª¨ íƒœê·¸
        const memoTags = log.memoTags || [];
        memoTags.forEach(t => {
          if (tagCounts[t] != null) tagCounts[t] += 1;
        });
        const tagSummary = memoTags.join(", ");

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${log.date || "-"}</td>
          <td>${sleepText}</td>
          <td>${medSummary || "-"}</td>
          <td>${log.mood || "-"}</td>
          <td>${log.energy || "-"}</td>
          <td>${log.focus || "-"}</td>
          <td>${log.taskDone || 0}%</td>
          <td>${tagSummary || "-"}</td>
          <td>${(log.notes || "").slice(0, 15)}${log.notes && log.notes.length > 15 ? "..." : ""}</td>
        `;
        tbody.appendChild(tr);
      });

      // íƒœê·¸ í†µê³„ í‘œì‹œ
      const statsDiv = document.getElementById("tagStats");
      const totalLogs = logs.length;
      if (!totalLogs) {
        statsDiv.textContent = "ì•„ì§ ì €ì¥ëœ ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.";
        return;
      }
      const parts = [];
      MEMO_TAG_LIST.forEach(tag => {
        const cnt = tagCounts[tag] || 0;
        parts.push(`${tag}: ${cnt}íšŒ`);
      });
      statsDiv.textContent = parts.join(" / ");
    }

    function updateCheckSummaryUI(log) {
      document.getElementById("totalCheckCount").textContent = log.totalCheckCount || 0;
      document.getElementById("checkCount1").textContent = log.checkCount1 || 0;
      document.getElementById("checkCount2").textContent = log.checkCount2 || 0;
      document.getElementById("checkCount3").textContent = log.checkCount3 || 0;
      document.getElementById("checkCount4").textContent = log.checkCount4 || 0;
      document.getElementById("checkCount5").textContent = log.checkCount5 || 0;
    }

    document.getElementById("logForm").addEventListener("submit", function (e) {
      e.preventDefault();

      // ë©”ëª¨ íƒœê·¸ ìˆ˜ì§‘
      const tagChecks = Array.from(document.querySelectorAll(".memoTag"));
      const memoTags = tagChecks.filter(c => c.checked).map(c => c.value);

      const log = {
        date: document.getElementById("date").value,

        keyTask1: document.getElementById("keyTask1").value,
        keyTask1Done: document.getElementById("keyTask1Done").checked,
        keyTask2: document.getElementById("keyTask2").value,
        keyTask2Done: document.getElementById("keyTask2Done").checked,
        keyTask3: document.getElementById("keyTask3").value,
        keyTask3Done: document.getElementById("keyTask3Done").checked,

        keyNotTasks: document.getElementById("keyNotTasks").value,
        keyNotTasksDone: document.getElementById("keyNotTasksDone").checked,

        med1Name: document.getElementById("med1Name").value,
        med1Taken: document.getElementById("med1Taken").checked,
        med1TimeLabel: document.getElementById("med1TimeLabel").textContent,

        med2Name: document.getElementById("med2Name").value,
        med2Taken: document.getElementById("med2Taken").checked,
        med2TimeLabel: document.getElementById("med2TimeLabel").textContent,

        med3Name: document.getElementById("med3Name").value,
        med3Taken: document.getElementById("med3Taken").checked,
        med3TimeLabel: document.getElementById("med3TimeLabel").textContent,

        bedNote: document.getElementById("bedNote").value,
        bedStamp: document.getElementById("bedStamp").textContent,
        phoneNote: document.getElementById("phoneNote").value,
        phoneStamp: document.getElementById("phoneStamp").textContent,
        noSleepNote: document.getElementById("noSleepNote").value,
        noSleepStamp: document.getElementById("noSleepStamp").textContent,
        sleepRealNote: document.getElementById("sleepRealNote").value,
        sleepRealStamp: document.getElementById("sleepRealStamp").textContent,
        wakeNote: document.getElementById("wakeNote").value,
        wakeStamp: document.getElementById("wakeStamp").textContent,
        lingerNote: document.getElementById("lingerNote").value,
        lingerStamp: document.getElementById("lingerStamp").textContent,
        wakeRealNote: document.getElementById("wakeRealNote").value,
        wakeRealStamp: document.getElementById("wakeRealStamp").textContent,
        allNightNote: document.getElementById("allNightNote").value,
        allNightStamp: document.getElementById("allNightStamp").textContent,

        mood: document.getElementById("mood").value,
        energy: document.getElementById("energy").value,
        focus: document.getElementById("focus").value,
        moodReason: document.getElementById("moodReason").value,

        taskDone: document.getElementById("taskDone").value,
        notes: document.getElementById("notes").value,
        memoTags: memoTags,
        notDoneFeeling: document.getElementById("notDoneFeeling").value,
        notesNotDone: document.getElementById("notesNotDone").value
      };

      // ì²´í¬ìˆ˜ ê³„ì‚°
      const checkCount1 =
        (log.keyTask1Done ? 1 : 0) +
        (log.keyTask2Done ? 1 : 0) +
        (log.keyTask3Done ? 1 : 0) +
        (log.keyNotTasksDone ? 1 : 0);

      const checkCount2 =
        (log.med1Taken ? 1 : 0) +
        (log.med2Taken ? 1 : 0) +
        (log.med3Taken ? 1 : 0);

      const checkCount3 =
        (log.bedStamp ? 1 : 0) +
        (log.phoneStamp ? 1 : 0) +
        (log.noSleepStamp ? 1 : 0) +
        (log.sleepRealStamp ? 1 : 0) +
        (log.wakeStamp ? 1 : 0) +
        (log.lingerStamp ? 1 : 0) +
        (log.wakeRealStamp ? 1 : 0) +
        (log.allNightStamp ? 1 : 0);

      const checkCount4 =
        (Number(log.mood) > 0 ? 1 : 0) +
        (log.energy ? 1 : 0) +
        (log.focus ? 1 : 0) +
        (log.moodReason ? 1 : 0);

      const checkCount5 =
        (Number(log.taskDone) > 0 ? 1 : 0) +
        (Number(log.notDoneFeeling) > 0 ? 1 : 0) +
        (log.notes ? 1 : 0) +
        (log.notesNotDone ? 1 : 0) +
        (log.memoTags ? log.memoTags.length : 0);

      const totalCheckCount = checkCount1 + checkCount2 + checkCount3 + checkCount4 + checkCount5;

      log.checkCount1 = checkCount1;
      log.checkCount2 = checkCount2;
      log.checkCount3 = checkCount3;
      log.checkCount4 = checkCount4;
      log.checkCount5 = checkCount5;
      log.totalCheckCount = totalCheckCount;

      const logs = loadLogs();
      const idx = logs.findIndex(l => l.date === log.date);
      if (idx >= 0) {
        logs[idx] = log;
      } else {
        logs.push(log);
      }
      saveLogs(logs);
      renderTableAndStats();
      updateCheckSummaryUI(log);
      alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    });

    // ì´ˆê¸° ë Œë”
    renderTableAndStats();

    // í˜ì´ì§€ ë¡œë“œ ì‹œ, ì˜¤ëŠ˜ ë‚ ì§œ ë¡œê·¸ê°€ ì´ë¯¸ ìˆìœ¼ë©´ ì²´í¬ìš”ì•½ë§Œ ë¶ˆëŸ¬ì˜¤ê¸° (ì„ íƒ)
    (function initTodaySummary() {
      const logs = loadLogs();
      const today = document.getElementById("date").value;
      const todayLog = logs.find(l => l.date === today);
      if (todayLog && todayLog.totalCheckCount != null) {
        updateCheckSummaryUI(todayLog);
      }
    })();
  </script>
</body>
</html>
