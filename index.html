<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì—ì´ë© ì¼ì¼ë¡œê·¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      background: #f5f5f7;
      color: #111;
    }
    .app {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: #fff;
    }
    /* ìƒë‹¨ ì•±ë°” */
    .app-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 12px;
      border-bottom: 1px solid #ddd;
    }
    .icon-btn {
      width: 32px;
      height: 32px;
      border-radius: 16px;
      border: none;
      background: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
    }
    .app-title {
      font-weight: 700;
      font-size: 1.1rem;
    }

    .content {
      flex: 1;
      padding: 8px 12px 120px; /* ì•„ë˜ìª½ ì—¬ë°±: ê¸°ë¡ì…ë ¥ + ë„¤ë¹„ê²Œì´ì…˜ */
      overflow-y: auto;
    }

    /* ì§„í–‰ë¥  ë°” */
    .progress-card {
      margin-top: 8px;
      padding: 10px;
      border-radius: 12px;
      background: #fafafa;
      border: 1px solid #e0e0e0;
    }
    .progress-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
      font-size: 0.85rem;
    }
    .progress-label {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .progress-bar-wrap {
      width: 100%;
      height: 10px;
      border-radius: 999px;
      background: #e5e5e5;
      overflow: hidden;
    }
    .progress-bar-fill {
      width: 40%; /* TODO: ì‹¤ì œ ë°ì´í„°ì™€ ì—°ë™ */
      height: 100%;
      background: #50c878;
      transition: width 0.2s ease;
    }

    /* ìƒë‹¨ ìš”ì•½ ì¹´ë“œ (ì•½ ë³µìš© / ìˆ˜ë©´ ê´€ë¦¬) */
    .summary-card {
      margin-top: 8px;
      padding: 10px;
      border-radius: 12px;
      background: #ffffff;
      border: 1px solid #dde3ff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.04);
    }
    .summary-row {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 0;
      font-size: 0.85rem;
      flex-wrap: wrap;
    }
    .summary-label {
      width: 66px;
      font-weight: 600;
    }
    .summary-slot {
      font-weight: 500;
      min-width: 40px;
    }
    .summary-time-plan {
      font-size: 0.78rem;
      color: #777;
    }
    .summary-time-plan.done {
      text-decoration: line-through;
      color: #bbb;
    }
    .summary-time-actual {
      font-size: 0.85rem;
      color: #d32f2f;
      font-weight: 600;
    }
    .summary-diff {
      font-size: 0.78rem;
      color: #d32f2f;
    }
    .summary-checkbox {
      transform: scale(1.1);
    }
    .btn-next, .btn-prev {
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.78rem;
      cursor: pointer;
      white-space: nowrap;
    }
    .btn-next {
      border: none;
      background: #4caf50;
      color: #fff;
      margin-left: auto;
    }
    .btn-prev {
      border: 1px solid #bbb;
      background: #ffffff;
      color: #555;
    }

    /* ì•½&ìˆ˜ë©´ ì•„ì½”ë””ì–¸ */
    details.accordion {
      margin-top: 10px;
      border-radius: 12px;
      border: 1px solid #ddd;
      background: #fafafa;
    }
    details.accordion summary {
      list-style: none;
      padding: 8px 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.9rem;
      font-weight: 600;
    }
    details.accordion[open] summary {
      border-bottom: 1px solid #ddd;
    }
    details.accordion summary::-webkit-details-marker {
      display: none;
    }
    .accordion-body {
      padding: 8px 8px 10px;
    }
    .two-columns {
      display: flex;
      gap: 8px;
    }
    .column-card {
      flex: 1;
      background: #fff;
      border-radius: 10px;
      border: 1px solid #e0e0e0;
      padding: 8px;
      max-height: 200px;
      overflow-y: auto;
    }
    .column-title {
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .slot-row {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 0.8rem;
      padding: 2px 0;
    }
    .slot-row input[type="checkbox"] {
      flex-shrink: 0;
    }
    .slot-name {
      min-width: 40px;
    }
    .slot-plan {
      font-size: 0.75rem;
      color: #777;
    }
    .slot-plan.done {
      text-decoration: line-through;
      color: #bbb;
    }
    .slot-actual {
      font-size: 0.75rem;
      color: #d32f2f;
    }

    /* ê¸°ë¡ ë³´ê¸° */
    .state-log-list {
      max-height: 160px;
      overflow-y: auto;
      font-size: 0.8rem;
    }
    .state-log-item {
      padding: 4px 0;
      border-bottom: 1px solid #f0f0f0;
    }
    .state-log-time {
      font-size: 0.75rem;
      color: #777;
    }

    /* í•˜ë‹¨ ì…ë ¥ ë°” (ë‚´ ìƒíƒœ ê¸°ë¡) */
    .state-input-bar {
      position: sticky;
      bottom: 48px; /* ë„¤ë¹„ê²Œì´ì…˜ ë†’ì´ */
      background: #ffffff;
      border-top: 1px solid #ddd;
      padding: 4px 10px 6px;
      z-index: 6;
    }
    .state-input-title {
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 2px;
    }
    .state-input-row {
      display: flex;
      gap: 6px;
      margin-top: 2px;
    }
    .state-input-row input[type="text"] {
      flex: 1;
      padding: 6px;
      font-size: 0.85rem;
    }
    .btn-send {
      padding: 6px 10px;
      font-size: 0.85rem;
      border-radius: 999px;
      border: none;
      background: #1976d2;
      color: #fff;
      cursor: pointer;
      white-space: nowrap;
    }

    /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
    .bottom-nav {
      position: sticky;
      bottom: 0;
      left: 0;
      right: 0;
      height: 48px;
      border-top: 1px solid #ddd;
      background: #fff;
      display: flex;
      z-index: 5;
    }
    .nav-item {
      flex: 1;
      font-size: 0.7rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: #555;
    }
    .nav-item.active {
      color: #1976d2;
      font-weight: 600;
    }

    @media (min-width: 768px) {
      .app {
        margin-top: 16px;
        margin-bottom: 16px;
        border-radius: 16px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.06);
      }
    }
  </style>
</head>
<body>
<div class="app">
  <!-- ìƒë‹¨ ì•±ë°” -->
  <header class="app-bar">
    <button class="icon-btn" title="ì„¤ì • / ë©”ë‰´">
      â˜°
    </button>
    <div class="app-title">A-Lab Â· ì¼ì¼ë¡œê·¸</div>
    <div style="width:32px;height:32px;"></div>
  </header>

  <main class="content">
    <!-- ì§„í–‰ë¥  ì¹´ë“œ -->
    <section class="progress-card">
      <div class="progress-header">
        <div class="progress-label">
          ğŸƒâ€â™€ï¸ <span>ì˜¤ëŠ˜ ì§„í–‰ë¥ </span>
        </div>
        <span class="small" id="progressText">ì•½Â·ìˆ˜ë©´ ê¸°ì¤€ (ì„ì‹œ)</span>
      </div>
      <div class="progress-bar-wrap">
        <div class="progress-bar-fill" id="progressBar"></div>
      </div>
    </section>

    <!-- ìƒë‹¨ ìš”ì•½ ì¹´ë“œ (ì•½ ë³µìš© / ìˆ˜ë©´ ê´€ë¦¬) -->
    <section class="summary-card">
      <!-- ì•½ ë³µìš© -->
      <div class="summary-row" id="summaryMedRow">
        <span class="summary-label">ì•½ ë³µìš©</span>
        <input type="checkbox" id="summaryMedCheck" class="summary-checkbox" />
        <span class="summary-slot" id="summaryMedSlot">-</span>
        <span class="summary-time-plan" id="summaryMedPlan">(--:--)</span>
        <span class="summary-time-actual" id="summaryMedActual"></span>
        <span class="summary-diff" id="summaryMedDiff"></span>
        <button type="button" class="btn-prev" id="summaryMedPrevBtn">ì´ì „</button>
        <button type="button" class="btn-next" id="summaryMedNextBtn">ë‹¤ìŒì—</button>
      </div>
      <!-- ìˆ˜ë©´ ê´€ë¦¬ -->
      <div class="summary-row" id="summarySleepRow">
        <span class="summary-label">ìˆ˜ë©´ ê´€ë¦¬</span>
        <input type="checkbox" id="summarySleepCheck" class="summary-checkbox" />
        <span class="summary-slot" id="summarySleepSlot">-</span>
        <span class="summary-time-plan" id="summarySleepPlan">(--:--)</span>
        <span class="summary-time-actual" id="summarySleepActual"></span>
        <span class="summary-diff" id="summarySleepDiff"></span>
        <button type="button" class="btn-prev" id="summarySleepPrevBtn">ì´ì „</button>
        <button type="button" class="btn-next" id="summarySleepNextBtn">ë‹¤ìŒì—</button>
      </div>
    </section>

    <!-- ì•½&ìˆ˜ë©´ ì•„ì½”ë””ì–¸ -->
    <details class="accordion" id="medSleepAccordion" open>
      <summary>
        <span>ì•½ & ìˆ˜ë©´</span>
        <span class="small">í¼ì¹˜ê¸° / ì ‘ê¸°</span>
      </summary>
      <div class="accordion-body">
        <div class="two-columns">
          <!-- ì•½ ë³µìš© ë¦¬ìŠ¤íŠ¸ -->
          <div class="column-card">
            <div class="column-title">
              <span>ì•½ ë³µìš©</span>
              <span class="small">ì²´í¬ ì‹œ ìƒë‹¨ "ì•½ ë³µìš©"ì— ë°˜ì˜</span>
            </div>
            <div id="medSlotsContainer"></div>
          </div>
          <!-- ìˆ˜ë©´ ê´€ë¦¬ ë¦¬ìŠ¤íŠ¸ -->
          <div class="column-card">
            <div class="column-title">
              <span>ìˆ˜ë©´ ê´€ë¦¬</span>
              <span class="small">ì²´í¬ ì‹œ ìƒë‹¨ "ìˆ˜ë©´ ê´€ë¦¬"ì— ë°˜ì˜</span>
            </div>
            <div id="sleepSlotsContainer"></div>
          </div>
        </div>
      </div>
    </details>

    <!-- ê¸°ë¡ ë³´ê¸° ì•„ì½”ë””ì–¸ -->
    <details class="accordion" id="logAccordion" open>
      <summary>
        <span>ê¸°ë¡ ë³´ê¸°</span>
        <span class="small">ë‚´ ìƒíƒœ ê¸°ë¡ ë¦¬ìŠ¤íŠ¸</span>
      </summary>
      <div class="accordion-body">
        <div class="state-log-list" id="stateLogList"></div>
      </div>
    </details>
  </main>

  <!-- ë‚´ ìƒíƒœ ê¸°ë¡ ì…ë ¥ ë°” -->
  <div class="state-input-bar">
    <div class="state-input-title">ë‚´ ìƒíƒœ ê¸°ë¡</div>
    <div class="state-input-row">
      <input type="text" id="stateInput" placeholder="ì§€ê¸ˆ ìƒíƒœë¥¼ í•œ ì¤„ë¡œ ì ì–´ì£¼ì„¸ìš”." />
      <button type="button" class="btn-send" id="stateSendBtn">ì „ì†¡</button>
    </div>
  </div>

  <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="bottom-nav">
    <div class="nav-item active" data-tab="state">
      <div>ğŸ˜Š</div>
      <div>ë‚´ ìƒíƒœ</div>
    </div>
    <div class="nav-item" data-tab="todo">
      <div>âœ…</div>
      <div>í• ì¼ ë£¨í‹´</div>
    </div>
    <div class="nav-item" data-tab="camera">
      <div>ğŸ“·</div>
      <div>ì¹´ë©”ë¼</div>
    </div>
    <div class="nav-item" data-tab="medsleep">
      <div>ğŸ’Š</div>
      <div>ì•½&ìˆ˜ë©´</div>
    </div>
    <div class="nav-item" data-tab="stats">
      <div>ğŸ“Š</div>
      <div>í†µê³„ë³´ê¸°</div>
    </div>
  </nav>
</div>

<script>
  /* -------------------------
     1. ì•½ / ìˆ˜ë©´ ìŠ¬ë¡¯ ê¸°ë³¸ ì„¤ì •
  ------------------------- */
  const medSlotsConfig = [
    { id: "med_morning", label: "ì•„ì¹¨",   planTime: "09:00" },
    { id: "med_lunch",   label: "ì ì‹¬",   planTime: "13:00" },
    { id: "med_dinner",  label: "ì €ë…",   planTime: "19:00" },
    { id: "med_night",   label: "ì·¨ì¹¨",   planTime: "23:00" },
    { id: "med_prn",     label: "í•„ìš”ì‹œ", planTime: "--:--" },
    { id: "med_custom",  label: "ì§ì ‘ì…ë ¥", planTime: "--:--" }
  ];

  const sleepSlotsConfig = [
    { id: "sleep_bed",    label: "ëˆ„ì›€",   planTime: "01:00" },
    { id: "sleep_sleep",  label: "ì ë“¦",   planTime: "01:30" },
    { id: "sleep_wake",   label: "ê¸°ìƒ",   planTime: "08:00" },
    { id: "sleep_nap",    label: "ë‚®ì ",   planTime: "15:00" },
    { id: "sleep_custom", label: "ì§ì ‘ì…ë ¥", planTime: "--:--" }
  ];

  let medSlotsState = medSlotsConfig.map(s => ({ ...s, checked: false, actualTime: null }));
  let sleepSlotsState = sleepSlotsConfig.map(s => ({ ...s, checked: false, actualTime: null }));

  function firstUncheckedIndex(arr) {
    const idx = arr.findIndex(s => !s.checked);
    return idx === -1 ? 0 : idx;
  }

  let currentMedIndex = firstUncheckedIndex(medSlotsState);
  let currentSleepIndex = firstUncheckedIndex(sleepSlotsState);

  /* -------------------------
     2. ì‹œê°„ ê´€ë ¨ ìœ í‹¸
  ------------------------- */
  function formatNowTime() {
    const d = new Date();
    const hh = String(d.getHours()).padStart(2, "0");
    const mm = String(d.getMinutes()).padStart(2, "0");
    return `${hh}:${mm}`;
  }

  function diffTime(plan, actual) {
    if (!plan || plan === "--:--" || !actual) return "";
    const [ph, pm] = plan.split(":").map(Number);
    const [ah, am] = actual.split(":").map(Number);
    const planMin = ph * 60 + pm;
    const actMin = ah * 60 + am;
    let diff = actMin - planMin; // + ëŠ¦ê²Œ, - ì¼ì°
    const sign = diff === 0 ? "Â±" : (diff > 0 ? "+" : "-");
    diff = Math.abs(diff);
    const h = Math.floor(diff / 60);
    const m = diff % 60;
    return `${sign}${h}h${String(m).padStart(2, "0")}m`;
  }

  /* -------------------------
     3. ì•½/ìˆ˜ë©´ ìŠ¬ë¡¯ ë Œë”ë§
  ------------------------- */
  function renderSlotsList() {
    const medContainer = document.getElementById("medSlotsContainer");
    const sleepContainer = document.getElementById("sleepSlotsContainer");
    medContainer.innerHTML = "";
    sleepContainer.innerHTML = "";

    medSlotsState.forEach((slot, index) => {
      const row = document.createElement("div");
      row.className = "slot-row";

      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = slot.checked;
      cb.dataset.type = "med";
      cb.dataset.index = index;

      const nameSpan = document.createElement("span");
      nameSpan.className = "slot-name";
      nameSpan.textContent = slot.label;

      const planSpan = document.createElement("span");
      planSpan.className = "slot-plan" + (slot.checked ? " done" : "");
      planSpan.textContent = `(${slot.planTime})`;

      const actualSpan = document.createElement("span");
      actualSpan.className = "slot-actual";
      actualSpan.textContent = slot.actualTime ? slot.actualTime : "";

      row.appendChild(cb);
      row.appendChild(nameSpan);
      row.appendChild(planSpan);
      row.appendChild(actualSpan);
      medContainer.appendChild(row);
    });

    sleepSlotsState.forEach((slot, index) => {
      const row = document.createElement("div");
      row.className = "slot-row";

      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = slot.checked;
      cb.dataset.type = "sleep";
      cb.dataset.index = index;

      const nameSpan = document.createElement("span");
      nameSpan.className = "slot-name";
      nameSpan.textContent = slot.label;

      const planSpan = document.createElement("span");
      planSpan.className = "slot-plan" + (slot.checked ? " done" : "");
      planSpan.textContent = `(${slot.planTime})`;

      const actualSpan = document.createElement("span");
      actualSpan.className = "slot-actual";
      actualSpan.textContent = slot.actualTime ? slot.actualTime : "";

      row.appendChild(cb);
      row.appendChild(nameSpan);
      row.appendChild(planSpan);
      row.appendChild(actualSpan);
      sleepContainer.appendChild(row);
    });
  }

  function updateProgress() {
    const totalSlots = medSlotsState.length + sleepSlotsState.length;
    const doneSlots =
      medSlotsState.filter(s => s.checked).length +
      sleepSlotsState.filter(s => s.checked).length;
    const rate = totalSlots === 0 ? 0 : Math.round((doneSlots / totalSlots) * 100);
    document.getElementById("progressBar").style.width = `${rate}%`;
    document.getElementById("progressText").textContent = `ì˜¤ëŠ˜ ì²´í¬ ì§„í–‰ë¥  ${rate}% (ì„ì‹œ)`;
  }

  function renderSummary() {
    // ì•½ ë³µìš©
    const medSlot = medSlotsState[currentMedIndex];
    document.getElementById("summaryMedSlot").textContent = medSlot.label;
    const mPlanSpan = document.getElementById("summaryMedPlan");
    mPlanSpan.textContent = `(${medSlot.planTime})`;
    mPlanSpan.className = "summary-time-plan" + (medSlot.checked ? " done" : "");
    const mActualSpan = document.getElementById("summaryMedActual");
    mActualSpan.textContent = medSlot.actualTime ? medSlot.actualTime : "";
    const mDiffSpan = document.getElementById("summaryMedDiff");
    mDiffSpan.textContent = medSlot.actualTime ? diffTime(medSlot.planTime, medSlot.actualTime) : "";
    document.getElementById("summaryMedCheck").checked = medSlot.checked;

    // ìˆ˜ë©´ ê´€ë¦¬
    const sleepSlot = sleepSlotsState[currentSleepIndex];
    document.getElementById("summarySleepSlot").textContent = sleepSlot.label;
    const sPlanSpan = document.getElementById("summarySleepPlan");
    sPlanSpan.textContent = `(${sleepSlot.planTime})`;
    sPlanSpan.className = "summary-time-plan" + (sleepSlot.checked ? " done" : "");
    const sActualSpan = document.getElementById("summarySleepActual");
    sActualSpan.textContent = sleepSlot.actualTime ? sleepSlot.actualTime : "";
    const sDiffSpan = document.getElementById("summarySleepDiff");
    sDiffSpan.textContent = sleepSlot.actualTime ? diffTime(sleepSlot.planTime, sleepSlot.actualTime) : "";
    document.getElementById("summarySleepCheck").checked = sleepSlot.checked;

    updateProgress();
  }

  // ì´ˆê¸° ë Œë”
  renderSlotsList();
  renderSummary();

  /* -------------------------
     4. ìŠ¬ë¡¯ í† ê¸€ / ì»¤ì„œ ì´ë™
  ------------------------- */

  // ì²´í¬/í•´ì œë§Œ ì²˜ë¦¬ (ì»¤ì„œ ì´ë™ì€ í•˜ì§€ ì•ŠìŒ)
  function handleSlotToggle(type, index, checkedFromUser) {
    const stateArr = type === "med" ? medSlotsState : sleepSlotsState;
    const slot = stateArr[index];

    slot.checked = checkedFromUser;
    slot.actualTime = checkedFromUser ? formatNowTime() : null;

    renderSlotsList();
    renderSummary();
  }

  // í•˜ë‹¨ ë¦¬ìŠ¤íŠ¸ ì²´í¬
  document.getElementById("medSlotsContainer").addEventListener("change", (e) => {
    if (e.target.type === "checkbox") {
      const idx = Number(e.target.dataset.index);
      handleSlotToggle("med", idx, e.target.checked);
    }
  });
  document.getElementById("sleepSlotsContainer").addEventListener("change", (e) => {
    if (e.target.type === "checkbox") {
      const idx = Number(e.target.dataset.index);
      handleSlotToggle("sleep", idx, e.target.checked);
    }
  });

  // ìƒë‹¨ ìš”ì•½ ì²´í¬
  document.getElementById("summaryMedCheck").addEventListener("change", (e) => {
    handleSlotToggle("med", currentMedIndex, e.target.checked);
  });
  document.getElementById("summarySleepCheck").addEventListener("change", (e) => {
    handleSlotToggle("sleep", currentSleepIndex, e.target.checked);
  });

  // ì»¤ì„œ ì´ë™: ë‹¤ìŒ / ì´ì „
  function moveNextSlot(type) {
    const stateArr = type === "med" ? medSlotsState : sleepSlotsState;
    if (!stateArr.length) return;
    if (type === "med") {
      currentMedIndex = (currentMedIndex + 1) % stateArr.length;
    } else {
      currentSleepIndex = (currentSleepIndex + 1) % stateArr.length;
    }
    renderSummary();
  }

  function movePrevSlot(type) {
    const stateArr = type === "med" ? medSlotsState : sleepSlotsState;
    if (!stateArr.length) return;
    if (type === "med") {
      currentMedIndex = (currentMedIndex - 1 + stateArr.length) % stateArr.length;
    } else {
      currentSleepIndex = (currentSleepIndex - 1 + stateArr.length) % stateArr.length;
    }
    renderSummary();
  }

  document.getElementById("summaryMedNextBtn").addEventListener("click", () => {
    moveNextSlot("med");
  });
  document.getElementById("summarySleepNextBtn").addEventListener("click", () => {
    moveNextSlot("sleep");
  });
  document.getElementById("summaryMedPrevBtn").addEventListener("click", () => {
    movePrevSlot("med");
  });
  document.getElementById("summarySleepPrevBtn").addEventListener("click", () => {
    movePrevSlot("sleep");
  });

  /* -------------------------
     5. ë‚´ ìƒíƒœ ê¸°ë¡ / ê¸°ë¡ ë³´ê¸°
  ------------------------- */

  const stateInput = document.getElementById("stateInput");
  const stateLogList = document.getElementById("stateLogList");
  const stateSendBtn = document.getElementById("stateSendBtn");

  const stateLogs = []; // { text, timeStr, totalMinutes, diffText }

  function addStateLog(text) {
    const now = new Date();
    const hh = String(now.getHours()).padStart(2, "0");
    const mm = String(now.getMinutes()).padStart(2, "0");
    const timeStr = `${hh}:${mm}`;
    let totalMinutes = now.getHours() * 60 + now.getMinutes();

    let diffText = "ë°©ê¸ˆ ì „";
    if (stateLogs.length > 0) {
      const prev = stateLogs[stateLogs.length - 1];
      let diffMin = totalMinutes - prev.totalMinutes;
      if (diffMin < 0) diffMin += 24 * 60; // ìì • ë„˜ì–´ê°„ ê²½ìš° ë³´ì •

      if (diffMin < 1) {
        diffText = "ë°©ê¸ˆ ì „";
      } else {
        const h = Math.floor(diffMin / 60);
        const m = diffMin % 60;
        if (h === 0) {
          diffText = `${m}ë¶„ ì „`;
        } else if (m === 0) {
          diffText = `${h}ì‹œê°„ ì „`;
        } else {
          diffText = `${h}ì‹œê°„ ${m}ë¶„ ì „`;
        }
      }
    }

    stateLogs.push({ text, timeStr, totalMinutes, diffText });
    renderStateLogs();
  }

  function renderStateLogs() {
    stateLogList.innerHTML = "";
    const logsToShow = [...stateLogs].reverse(); // ìµœì‹ ì´ ìœ„ë¡œ
    logsToShow.forEach((log) => {
      const item = document.createElement("div");
      item.className = "state-log-item";
      item.innerHTML = `
        <div>${log.text}</div>
        <div class="state-log-time">${log.timeStr} Â· ${log.diffText}</div>
      `;
      stateLogList.appendChild(item);
    });
  }

  stateSendBtn.addEventListener("click", () => {
    const text = stateInput.value.trim();
    if (!text) return;
    addStateLog(text);
    stateInput.value = "";
  });

  stateInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      stateSendBtn.click();
    }
  });

  /* -------------------------
     6. í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ (ì„ì‹œ ë™ì‘)
  ------------------------- */
  document.querySelectorAll(".nav-item").forEach(item => {
    item.addEventListener("click", () => {
      document.querySelectorAll(".nav-item").forEach(i => i.classList.remove("active"));
      item.classList.add("active");
      const tab = item.dataset.tab;
      if (tab === "medsleep") {
        alert("ì•½&ìˆ˜ë©´ ìƒì„¸ ì„¤ì • í™”ë©´ì€ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.");
      } else if (tab !== "state") {
        alert(`"${item.innerText.trim()}" í™”ë©´ì€ ì¶”í›„ ì—°ê²° ì˜ˆì •ì…ë‹ˆë‹¤.`);
      }
    });
  });
</script>
</body>
</html>
