<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì—ì´ë© ì¼ì¼ ë¡œê·¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 16px; }
    h1 { font-size: 1.4rem; margin-bottom: 8px; }
    h2 { font-size: 1.1rem; margin-top: 24px; margin-bottom: 8px; }
    .section { border: 1px solid #ccc; border-radius: 8px; padding: 12px; margin-bottom: 12px; }
    label { display: block; margin-bottom: 4px; font-size: 0.9rem; }
    input, select, textarea { width: 100%; padding: 6px; margin-bottom: 8px; box-sizing: border-box; }
    textarea { min-height: 60px; }
    button { padding: 8px 14px; border-radius: 6px; border: none; cursor: pointer; }
    button#saveBtn { background: #333; color: #fff; }
    table { width: 100%; border-collapse: collapse; margin-top: 12px; font-size: 0.85rem; }
    th, td { border: 1px solid #ddd; padding: 6px; text-align: center; }
    th { background: #f5f5f5; }
    .small { font-size: 0.8rem; color: #666; }
  </style>
</head>
<body>
  <h1>ì—ì´ë© ì¼ì¼ ë¡œê·¸</h1>
  <p class="small">ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤ (localStorage). ìƒˆë¡œê³ ì¹¨í•´ë„ ê¸°ë¡ì€ ë‚¨ìŠµë‹ˆë‹¤.</p>

  <form id="logForm">
    <!-- 1. ë‚ ì§œ & ì˜¤ëŠ˜ í•  ì¼ / ì•ˆ í•  ì¼ -->
    <div class="section">
      <h2>1. ë‚ ì§œ & ì˜¤ëŠ˜ í•  ì¼</h2>
      <label for="date">ë‚ ì§œ</label>
      <input type="date" id="date" required />

      <label for="keyTasks">ì˜¤ëŠ˜ í•µì‹¬ í•  ì¼ (í•œ ì¤„)</label>
      <input type="text" id="keyTasks" placeholder="ì˜ˆ: ì—ì´ë© ì¼ì¼ ë¡œê·¸ ì„¤ê³„" />

      <label for="keyNotTasks">ì˜¤ëŠ˜ ì•ˆ í•  ì¼ (í•œ ì¤„)</label>
      <input type="text" id="keyNotTasks" placeholder="ì˜ˆ: ì•¼ì‹, ì“¸ë°ì—†ëŠ” ë‰´ìŠ¤ ë³´ê¸°" />
    </div>

    <!-- 2. ì•½ 3ê°œê¹Œì§€ ê¸°ë¡ -->
    <div class="section">
      <h2>2. ì•½ ğŸ’Š (ìµœëŒ€ 3ê°œ)</h2>

      <h3 style="font-size:0.95rem; margin:8px 0;">ì•½ 1</h3>
      <label for="med1Name">ì•½ 1 ì´ë¦„</label>
      <input type="text" id="med1Name" placeholder="ì˜ˆ: ì½˜ì„œíƒ€ 36mg" />

      <label>
        <input type="checkbox" id="med1Taken" />
        ì˜¤ëŠ˜ ì•½ 1 ë³µìš©í•¨
      </label>

      <label for="med1Time">ì•½ 1 ë³µìš© ì‹œê°„</label>
      <input type="time" id="med1Time" />

      <h3 style="font-size:0.95rem; margin:8px 0;">ì•½ 2</h3>
      <label for="med2Name">ì•½ 2 ì´ë¦„</label>
      <input type="text" id="med2Name" placeholder="ì˜ˆ: ë¼ë¯¹íƒˆ 100mg" />

      <label>
        <input type="checkbox" id="med2Taken" />
        ì˜¤ëŠ˜ ì•½ 2 ë³µìš©í•¨
      </label>

      <label for="med2Time">ì•½ 2 ë³µìš© ì‹œê°„</label>
      <input type="time" id="med2Time" />

      <h3 style="font-size:0.95rem; margin:8px 0;">ì•½ 3</h3>
      <label for="med3Name">ì•½ 3 ì´ë¦„</label>
      <input type="text" id="med3Name" placeholder="ì˜ˆ: ë¦¬ë³´íŠ¸ë¦´ 0.25mg" />

      <label>
        <input type="checkbox" id="med3Taken" />
        ì˜¤ëŠ˜ ì•½ 3 ë³µìš©í•¨
      </label>

      <label for="med3Time">ì•½ 3 ë³µìš© ì‹œê°„</label>
      <input type="time" id="med3Time" />
    </div>

    <!-- 3. ìˆ˜ë©´ -->
    <div class="section">
      <h2>3. ìˆ˜ë©´ ğŸŒ™</h2>

      <label for="bedTime">ëˆ„ìš´ ì‹œê°„</label>
      <input type="time" id="bedTime" />

      <label for="sleepReal">ì§„ì§œ ì”ë‹¤ (ì ë“  ì‹œê°)</label>
      <input type="time" id="sleepReal" />

      <label for="sleepStart">ì–´ì œ ì·¨ì¹¨ ì‹œê° (ê¸°ë¡ìš©)</label>
      <input type="time" id="sleepStart" />

      <label for="tossingTime">ë’¤ì²™ì¸ ì‹œê°„ (ììœ  ê¸°ì…)</label>
      <input type="text" id="tossingTime" placeholder="ì˜ˆ: 30ë¶„, ë§ì´ ë’¤ì²™ì„" />

      <label for="sleepEnd">ì˜¤ëŠ˜ ê¸°ìƒ ì‹œê°</label>
      <input type="time" id="sleepEnd" />

      <div class="small" id="sleepSummary"></div>
    </div>

    <!-- 4. ê¸°ë¶„ / ì—ë„ˆì§€ / ì§‘ì¤‘ + ì´ìœ  -->
    <div class="section">
      <h2>4. ê¸°ë¶„ / ì—ë„ˆì§€ / ì§‘ì¤‘ ğŸ™‚</h2>
      <label for="mood">ê¸°ë¶„ (1 ë§¤ìš° ë‚˜ì¨ ~ 5 ë§¤ìš° ì¢‹ìŒ)</label>
      <select id="mood">
        <option value="">ì„ íƒ</option>
        <option value="1">1 - ë§¤ìš° ë‚˜ì¨</option>
        <option value="2">2 - ë‚˜ì¨</option>
        <option value="3">3 - ë³´í†µ</option>
        <option value="4">4 - ì¢‹ìŒ</option>
        <option value="5">5 - ë§¤ìš° ì¢‹ìŒ</option>
      </select>

      <label for="energy">ì—ë„ˆì§€ / ê°ì„± ì •ë„</label>
      <select id="energy">
        <option value="">ì„ íƒ</option>
        <option value="1">1 - ê±°ì˜ ì—†ìŒ</option>
        <option value="2">2 - ë‚®ìŒ</option>
        <option value="3">3 - ë³´í†µ</option>
        <option value="4">4">4 - ë†’ìŒ</option>
        <option value="5">5 - ê³¼ê°ì„± ëŠë‚Œ</option>
      </select>

      <label for="focus">ì§‘ì¤‘ë„</label>
      <select id="focus">
        <option value="">ì„ íƒ</option>
        <option value="1">1 - ì „í˜€ ì•ˆ ë¨</option>
        <option value="2">2 - ì˜ ì•ˆ ë¨</option>
        <option value="3">3 - ì¤‘ê°„</option>
        <option value="4">4 - ì˜ ë¨</option>
        <option value="5">5 - ë§¤ìš° ì˜ ë¨</option>
      </select>

      <label for="moodReason">ì™œ ê·¸ëŸ° ê¸°ë¶„ì´ì—ˆëŠ”ì§€ (ê°„ë‹¨íˆ)</label>
      <input type="text" id="moodReason" placeholder="ì˜ˆ: ì  ë¶€ì¡±, ì‚¬ëŒê³¼ì˜ ê°ˆë“±, ì¼ ì˜ í’€ë¦¼ ë“±" />
    </div>

    <!-- 5. í•  ì¼ ì§„í–‰ & ë©”ëª¨ + ì˜¤ëŠ˜ ëª»í•œ ëŠë‚Œ -->
    <div class="section">
      <h2>5. í•  ì¼ ì§„í–‰ & ë©”ëª¨</h2>
      <label for="taskDone">ì˜¤ëŠ˜ í•  ì¼ ì™„ë£Œìœ¨ (%)</label>
      <select id="taskDone">
        <option value="0">0%</option>
        <option value="25">25%</option>
        <option value="50">50%</option>
        <option value="75">75%</option>
        <option value="100">100%</option>
      </select>

      <label for="notes">ë©”ëª¨ / íŠ¹ì´ì‚¬í•­</label>
      <textarea id="notes" placeholder="ë¶€ì‘ìš©, ê¸°ë¶„ ë³€í™”, ì‚¬ê±´ ë“±ì„ ììœ ë¡­ê²Œ ì ê¸°"></textarea>

      <label for="notDoneFeeling">ì˜¤ëŠ˜ ëª»í•œ ëŠë‚Œ (%)</label>
      <input type="number" id="notDoneFeeling" min="0" max="100" placeholder="ì˜ˆ: 30 (ìˆ«ìë§Œ)" />

      <label for="notesNotDone">ë©”ëª¨ / íŠ¹ì´ì‚¬í•­ (ëª»í•œ ë¶€ë¶„ ìœ„ì£¼)</label>
      <textarea id="notesNotDone" placeholder="ëª»í•œ ì¼, ë‚¨ì€ ì°ì°í•¨ ë“±ì„ ììœ ë¡­ê²Œ ì ê¸°"></textarea>
    </div>

    <button type="submit" id="saveBtn">ì €ì¥</button>
  </form>

  <h2>ìµœê·¼ 7ì¼ ë¡œê·¸</h2>
  <table id="logTable">
    <thead>
      <tr>
        <th>ë‚ ì§œ</th>
        <th>ìˆ˜ë©´</th>
        <th>ì•½ (ë³µìš©í•œ ì•½ ì´ë¦„)</th>
        <th>ê¸°ë¶„</th>
        <th>ì—ë„ˆì§€</th>
        <th>ì§‘ì¤‘</th>
        <th>ì™„ë£Œìœ¨</th>
        <th>ë©”ëª¨</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const STORAGE_KEY = "dailyLogs_v2"; // v2ë¡œ ë³€ê²½ (êµ¬ë²„ì „ê³¼ êµ¬ë¶„)

    // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë³¸ê°’ ì„¤ì •
    (function setToday() {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, "0");
      const dd = String(today.getDate()).padStart(2, "0");
      document.getElementById("date").value = `${yyyy}-${mm}-${dd}`;
    })();

    function loadLogs() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return [];
      try {
        return JSON.parse(raw);
      } catch (e) {
        console.error("JSON parse error", e);
        return [];
      }
    }

    function saveLogs(logs) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(logs));
    }

    function calcSleepHours(start, end) {
      if (!start || !end) return "";
      const [sh, sm] = start.split(":").map(Number);
      const [eh, em] = end.split(":").map(Number);
      let startMin = sh * 60 + sm;
      let endMin = eh * 60 + em;
      // ìƒˆë²½ ë„˜ì–´ê°€ëŠ” ìˆ˜ë©´ ê³ ë ¤ (ì˜ˆ: 23:30 ~ 07:30)
      if (endMin <= startMin) {
        endMin += 24 * 60;
      }
      const diff = endMin - startMin;
      const h = Math.floor(diff / 60);
      const m = diff % 60;
      return `${h}ì‹œê°„ ${m}ë¶„`;
    }

    function renderSleepSummary() {
      const s = document.getElementById("sleepStart").value;
      const e = document.getElementById("sleepEnd").value;
      const summary = calcSleepHours(s, e);
      document.getElementById("sleepSummary").textContent =
        summary ? `ì´ ìˆ˜ë©´(ì·¨ì¹¨~ê¸°ìƒ ê¸°ì¤€): ${summary}` : "";
    }

    document.getElementById("sleepStart").addEventListener("change", renderSleepSummary);
    document.getElementById("sleepEnd").addEventListener("change", renderSleepSummary);

    function renderTable() {
      const logs = loadLogs().sort((a, b) => b.date.localeCompare(a.date));
      const tbody = document.querySelector("#logTable tbody");
      tbody.innerHTML = "";

      logs.slice(0, 7).forEach(log => {
        const sleepText = calcSleepHours(log.sleepStart, log.sleepEnd);

        // ì˜¤ëŠ˜ ë³µìš©í•œ ì•½ ì´ë¦„ ìš”ì•½
        const meds = [];
        if (log.med1Name && log.med1Taken) meds.push(log.med1Name);
        if (log.med2Name && log.med2Taken) meds.push(log.med2Name);
        if (log.med3Name && log.med3Taken) meds.push(log.med3Name);
        const medSummary = meds.join(", ");

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${log.date || "-"}</td>
          <td>${sleepText || "-"}</td>
          <td>${medSummary || "-"}</td>
          <td>${log.mood || "-"}</td>
          <td>${log.energy || "-"}</td>
          <td>${log.focus || "-"}</td>
          <td>${log.taskDone || 0}%</td>
          <td>${(log.notes || "").slice(0, 15)}${log.notes && log.notes.length > 15 ? "..." : ""}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    document.getElementById("logForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const log = {
        date: document.getElementById("date").value,
        keyTasks: document.getElementById("keyTasks").value,
        keyNotTasks: document.getElementById("keyNotTasks").value,

        med1Name: document.getElementById("med1Name").value,
        med1Taken: document.getElementById("med1Taken").checked,
        med1Time: document.getElementById("med1Time").value,

        med2Name: document.getElementById("med2Name").value,
        med2Taken: document.getElementById("med2Taken").checked,
        med2Time: document.getElementById("med2Time").value,

        med3Name: document.getElementById("med3Name").value,
        med3Taken: document.getElementById("med3Taken").checked,
        med3Time: document.getElementById("med3Time").value,

        bedTime: document.getElementById("bedTime").value,
        sleepReal: document.getElementById("sleepReal").value,
        sleepStart: document.getElementById("sleepStart").value,
        tossingTime: document.getElementById("tossingTime").value,
        sleepEnd: document.getElementById("sleepEnd").value,

        mood: document.getElementById("mood").value,
        energy: document.getElementById("energy").value,
        focus: document.getElementById("focus").value,
        moodReason: document.getElementById("moodReason").value,

        taskDone: document.getElementById("taskDone").value,
        notes: document.getElementById("notes").value,
        notDoneFeeling: document.getElementById("notDoneFeeling").value,
        notesNotDone: document.getElementById("notesNotDone").value
      };

      const logs = loadLogs();
      // ê°™ì€ ë‚ ì§œê°€ ì´ë¯¸ ìˆìœ¼ë©´ ë®ì–´ì“°ê¸°
      const idx = logs.findIndex(l => l.date === log.date);
      if (idx >= 0) {
        logs[idx] = log;
      } else {
        logs.push(log);
      }
      saveLogs(logs);
      renderTable();
      alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    });

    // ì´ˆê¸° ë Œë”
    renderTable();
  </script>
</body>
</html>
